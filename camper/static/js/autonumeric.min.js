/**
* autoNumeric.js
* @author: Bob Knothe
* @author: Sokolov Yura aka funny_falcon
* @version: 1.7.4-B
*
* Created by Robert J. Knothe on 2010-10-25. Please report any bug at http://www.decorplanit.com/plugin/
* Created by Sokolov Yura on 2010-11-07. http://github.com/funny_falcon
*
* Copyright (c) 2011 Robert J. Knothe  http://www.decorplanit.com/plugin/
* Copyright (c) 2011 Sokolov Yura aka funny_falcon
*
* The MIT License (http://www.opensource.org/licenses/mit-license.php)
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/(function(e){function t(e){var t={};if(e.selectionStart===undefined){e.focus();var n=document.selection.createRange();t.length=n.text.length,n.moveStart("character",-e.value.length),t.end=n.text.length,t.start=t.end-t.length}else t.start=e.selectionStart,t.end=e.selectionEnd,t.length=t.end-t.start;return t}function n(e,t,n){if(e.selectionStart===undefined){e.focus();var r=e.createTextRange();r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r.select()}else e.selectionStart=t,e.selectionEnd=n}function r(t,n){e.each(n,function(r,i){if(typeof i=="function")n[r]=i(t,n,r);else if(typeof i=="string"){var s=i.substr(0,4);if(s==="fun:"){var o=e.autoNumeric[i.substr(4)];typeof o=="function"?n[r]=e.autoNumeric[i.substr(4)](t,n,r):n[r]=null}else s==="css:"&&(n[r]=e(i.substr(4)).val())}})}function i(e,t){typeof e[t]=="string"&&(e[t]*=1)}function s(t,n){var s=e.extend({},e.fn.autoNumeric.defaults,n);e.metadata&&(s=e.extend(s,t.metadata())),r(t,s);var o=s.vMax.toString().split("."),u=!s.vMin&&s.vMin!==0?[]:s.vMin.toString().split(".");i(s,"vMax"),i(s,"vMin"),i(s,"mDec"),s.aNeg=s.vMin<0?"-":"",typeof s.mDec!="number"&&(s.mDec=Math.max((o[1]?o[1]:"").length,(u[1]?u[1]:"").length)),s.altDec===null&&s.mDec>0&&(s.aDec==="."&&s.aSep!==","?s.altDec=",":s.aDec===","&&s.aSep!=="."&&(s.altDec="."));var a=s.aNeg?"([-\\"+s.aNeg+"]?)":"(-?)";s._aNegReg=a,s._skipFirst=new RegExp(a+"[^-"+(s.aNeg?"\\"+s.aNeg:"")+"\\"+s.aDec+"\\d]"+".*?(\\d|\\"+s.aDec+"\\d)"),s._skipLast=new RegExp("(\\d\\"+s.aDec+"?)[^\\"+s.aDec+"\\d]\\D*$");var f=(s.aNeg?s.aNeg:"-")+s.aNum+"\\"+s.aDec;return s.altDec&&s.altDec!==s.aSep&&(f+=s.altDec),s._allowed=new RegExp("[^"+f+"]","gi"),s._numReg=new RegExp(a+"(?:\\"+s.aDec+"?(\\d+\\"+s.aDec+"\\d+)|(\\d*(?:\\"+s.aDec+"\\d*)?))"),s}function o(e,t,n){if(t.aSign)while(e.indexOf(t.aSign)>-1)e=e.replace(t.aSign,"");e=e.replace(t._skipFirst,"$1$2"),e=e.replace(t._skipLast,"$1"),e=e.replace(t._allowed,""),t.altDec&&(e=e.replace(t.altDec,t.aDec));var r=e.match(t._numReg);e=r?[r[1],r[2],r[3]].join(""):"";if(n){var i="^"+t._aNegReg+"0*(\\d"+(n==="leading"?")":"|$)");i=new RegExp(i),e=e.replace(i,"$1$2")}return e}function u(e,t,n){if(t&&n){var r=e.split(t);r[1]&&r[1].length>n&&(n>0?(r[1]=r[1].substring(0,n),e=r.join(t)):e=r[0])}return e}function a(e,t,n){return t&&t!=="."&&(e=e.replace(t,".")),n&&n!=="-"&&(e=e.replace(n,"-")),e.match(/\d/)||(e+="0"),e}function f(e,t,n){return n&&n!=="-"&&(e=e.replace("-",n)),t&&t!=="."&&(e=e.replace(".",t)),e}function l(e,t){e=o(e,t),e=u(e,t.aDec,t.mDec),e=a(e,t.aDec,t.aNeg);var n=+e;return n>=t.vMin&&n<=t.vMax}function c(e,t,n){return e===""||e===t.aNeg?t.wEmpty==="zero"?e+"0":t.wEmpty==="sign"||n?e+t.aSign:e:null}function h(e,t){e=o(e,t);var n=c(e,t,!0);if(n!==null)return n;var r="";t.dGroup===2?r=/(\d)((\d)(\d{2}?)+)$/:t.dGroup===4?r=/(\d)((\d{4}?)+)$/:r=/(\d)((\d{3}?)+)$/;var i=e.split(t.aDec);t.altDec&&i.length===1&&(i=e.split(t.altDec));var s=i[0];if(t.aSep)while(r.test(s))s=s.replace(r,"$1"+t.aSep+"$2");t.mDec!==0&&i.length>1?(i[1].length>t.mDec&&(i[1]=i[1].substring(0,t.mDec)),e=s+t.aDec+i[1]):e=s;if(t.aSign){var u=e.indexOf(t.aNeg)!==-1;e=e.replace(t.aNeg,""),e=t.pSign==="p"?t.aSign+e:e+t.aSign,u&&(e=t.aNeg+e)}return e}function p(e,t,n,r){e=e===""?"0":e.toString();var i="",s=0,o="",u=typeof r=="boolean"||r===null?r?t:0:+r,a=function(e){var t=u===0?/(\.[1-9]*)0*$/:u===1?/(\.\d[1-9]*)0*$/:new RegExp("(\\.\\d{"+u+"}[1-9]*)0*$");return e=e.replace(t,"$1"),u===0&&(e=e.replace(/\.$/,"")),e};e.charAt(0)==="-"&&(o="-",e=e.replace("-","")),e.match(/^\d/)||(e="0"+e),o==="-"&&+e===0&&(o=""),+e>0&&(e=e.replace(/^0*(\d)/,"$1"));var f=e.lastIndexOf("."),l=f===-1?e.length-1:f,c=e.length-1-l;if(c<=t){i=e;if(c<u){f===-1&&(i+=".");while(c<u){var h="000000".substring(0,u-c);i+=h,c+=h.length}}else c>u?i=a(i):c===0&&u===0&&(i=i.replace(/\.$/,""));return o+i}var p=f+t,d=+e.charAt(p+1),v=e.substring(0,p+1).split(""),m=e.charAt(p)==="."?e.charAt(p-1)%2:e.charAt(p)%2;if(d>4&&n==="S"||d>4&&n==="A"&&o===""||d>5&&n==="A"&&o==="-"||d>5&&n==="s"||d>5&&n==="a"&&o===""||d>4&&n==="a"&&o==="-"||d>5&&n==="B"||d===5&&n==="B"&&m===1||d>0&&n==="C"&&o===""||d>0&&n==="F"&&o==="-"||d>0&&n==="U")for(s=v.length-1;s>=0;s-=1)if(v[s]!=="."){v[s]=+v[s]+1;if(v[s]<10)break;s>0&&(v[s]="0")}return v=v.slice(0,p+1),i=a(v.join("")),o+i}function d(t,n){this.options=n,this.that=t,this.$that=e(t),this.formatted=!1,this.io=s(this.$that,this.options),this.value=t.value}function v(e){var t=e.data("autoNumeric");return t||(t={},e.data("autoNumeric",t)),t}function m(e,t){var n=v(e),r=n.holder;return r===undefined&&t&&(r=new d(e.get(0),t),n.holder=r),r}function g(e){var t=e.data("autoNumeric");return t&&t.holder?t.holder.options:{}}function y(t){t=t||{};var n=e(this),r=m(n,t);r.io.aForm&&(this.value||r.io.wEmpty!=="empty")&&n.autoNumericSet(n.autoNumericGet(t),t)}function b(t){var n=e(t.target),r=m(n);return r.init(t),r.skipAllways(t)?(r.processed=!0,!0):r.processAllways()?(r.processed=!0,r.formatQuick(),t.preventDefault(),!1):(r.formatted=!1,!0)}function w(t){var n=e(t.target),r=m(n),i=r.processed;r.init(t);if(r.skipAllways(t))return!0;if(i)return t.preventDefault(),!1;if(r.processAllways()||r.processKeypress())return r.formatQuick(),t.preventDefault(),!1;r.formatted=!1}function E(t){var n=e(t.target),r=m(n);r.init(t);var i=r.skipAllways(t);r.kdCode=0,delete r.valuePartsBeforePaste;if(i)return!0;if(this.value==="")return!0;r.formatted||r.formatQuick()}function S(t){var n=e(t.target),r=m(n);r.inVal=n.val();var i=c(r.inVal,r.io,!0);i!==null&&n.val(i)}function x(t){var n=e(t.target),r=m(n),i=r.io,s=n.val(),u=s;s!==""&&(s=o(s,i),c(s,i)===null&&l(s,i)?(s=a(s,i.aDec,i.aNeg),s=p(s,i.mDec,i.mRound,i.aPad),s=f(s,i.aDec,i.aNeg)):s="");var d=c(s,i,!1);d===null&&(d=h(s,i)),d!==u&&n.val(d),d!==r.inVal&&(n.change(),delete r.inVal)}function T(t){return typeof t=="string"&&(t=t.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),t="#"+t.replace(/(:|\.)/g,"\\$1")),e(t)}d.prototype={init:function(e){this.value=this.that.value,this.io=s(this.$that,this.options),this.cmdKey=e.metaKey,this.shiftKey=e.shiftKey,this.selection=t(this.that);if(e.type==="keydown"||e.type==="keyup")this.kdCode=e.keyCode;this.which=e.which,this.processed=!1,this.formatted=!1},setSelection:function(e,t,r){e=Math.max(e,0),t=Math.min(t,this.that.value.length),this.selection={start:e,end:t,length:t-e},(r===undefined||r)&&n(this.that,e,t)},setPosition:function(e,t){this.setSelection(e,e,t)},getBeforeAfter:function(){var e=this.value,t=e.substring(0,this.selection.start),n=e.substring(this.selection.end,e.length);return[t,n]},getBeforeAfterStriped:function(){var e=this.getBeforeAfter();return e[0]=o(e[0],this.io),e[1]=o(e[1],this.io),e},normalizeParts:function(e,t){var n=this.io;t=o(t,n);var r=t.match(/^\d/)?!0:"leading";e=o(e,n,r),(e===""||e===n.aNeg)&&t>""&&(t=t.replace(/^0*(\d)/,"$1"));var i=e+t;if(n.aDec){var s=i.match(new RegExp("^"+n._aNegReg+"\\"+n.aDec));s&&(e=e.replace(s[1],s[1]+"0"),i=e+t)}return n.wEmpty==="zero"&&(i===n.aNeg||i==="")&&(e+="0"),[e,t]},setValueParts:function(e,t){var n=this.io,r=this.normalizeParts(e,t),i=r.join(""),s=r[0].length;return l(i,n)?(i=u(i,n.aDec,n.mDec),s>i.length&&(s=i.length),this.value=i,this.setPosition(s,!1),!0):!1},signPosition:function(){var e=this.io,t=e.aSign,n=this.that;if(t){var r=t.length;if(e.pSign==="p"){var i=e.aNeg&&n.value&&n.value.charAt(0)===e.aNeg;return i?[1,r+1]:[0,r]}var s=n.value.length;return[s-r,s]}return[1e3,-1]},expandSelectionOnSign:function(e){var t=this.signPosition(),n=this.selection;n.start<t[1]&&n.end>t[0]&&((n.start<t[0]||n.end>t[1])&&this.value.substring(Math.max(n.start,t[0]),Math.min(n.end,t[1])).match(/^\s*$/)?n.start<t[0]?this.setSelection(n.start,t[0],e):this.setSelection(t[1],n.end,e):this.setSelection(Math.min(n.start,t[0]),Math.max(n.end,t[1]),e))},checkPaste:function(){if(this.valuePartsBeforePaste!==undefined){var e=this.getBeforeAfter(),t=this.valuePartsBeforePaste;delete this.valuePartsBeforePaste,e[0]=e[0].substr(0,t[0].length)+o(e[0].substr(t[0].length),this.io),this.setValueParts(e[0],e[1])||(this.value=t.join(""),this.setPosition(t[0].length,!1))}},skipAllways:function(e){var t=this.kdCode,n=this.which,r=this.cmdKey;if(t===17&&e.type==="keyup"&&this.valuePartsBeforePaste!==undefined)return this.checkPaste(),!1;if(t>=112&&t<=123||t>=91&&t<=93||t>=9&&t<=31||t<8&&(n===0||n===t)||t===144||t===145||t===45)return!0;if(r&&t===65)return!0;if(!r||t!==67&&t!==86&&t!==88){if(r)return!0;if(t===37||t===39){var i=this.io.aSep,s=this.selection.start,o=this.that.value;return e.type==="keydown"&&i&&!this.shiftKey&&(t===37&&o.charAt(s-2)===i?this.setPosition(s-1):t===39&&o.charAt(s)===i&&this.setPosition(s+1)),!0}return t>=34&&t<=40?!0:!1}return e.type==="keydown"&&this.expandSelectionOnSign(),t===86&&(e.type==="keydown"||e.type==="keypress"?this.valuePartsBeforePaste===undefined&&(this.valuePartsBeforePaste=this.getBeforeAfter()):this.checkPaste()),e.type==="keydown"||e.type==="keypress"||t===67},processAllways:function(){var e;return this.kdCode===8||this.kdCode===46?(this.selection.length?(this.expandSelectionOnSign(!1),e=this.getBeforeAfterStriped(),this.setValueParts(e[0],e[1])):(e=this.getBeforeAfterStriped(),this.kdCode===8?e[0]=e[0].substring(0,e[0].length-1):e[1]=e[1].substring(1,e[1].length),this.setValueParts(e[0],e[1])),!0):!1},processKeypress:function(){var e=this.io,t=String.fromCharCode(this.which),n=this.getBeforeAfterStriped(),r=n[0],i=n[1];return t===e.aDec||e.altDec&&t===e.altDec||(t==="."||t===",")&&this.kdCode===110?!e.mDec||!e.aDec?!0:e.aNeg&&i.indexOf(e.aNeg)>-1?!0:r.indexOf(e.aDec)>-1?!0:i.indexOf(e.aDec)>0?!0:(i.indexOf(e.aDec)===0&&(i=i.substr(1)),this.setValueParts(r+e.aDec,i),!0):t==="-"||t==="+"?e.aNeg?(r===""&&i.indexOf(e.aNeg)>-1&&(r=e.aNeg,i=i.substring(1,i.length)),r.charAt(0)===e.aNeg?r=r.substring(1,r.length):r=t==="-"?e.aNeg+r:r,this.setValueParts(r,i),!0):!0:t>="0"&&t<="9"?(e.aNeg&&r===""&&i.indexOf(e.aNeg)>-1&&(r=e.aNeg,i=i.substring(1,i.length)),this.setValueParts(r+t,i),!0):!0},formatQuick:function(){var e=this.io,t=this.getBeforeAfterStriped(),n=h(this.value,this.io),r=n.length;if(n){var i=t[0].split(""),s;for(s=0;s<i.length;s+=1)i[s].match("\\d")||(i[s]="\\"+i[s]);var o=new RegExp("^.*?"+i.join(".*?")),u=n.match(o);u?(r=u[0].length,(r===0&&n.charAt(0)!==e.aNeg||r===1&&n.charAt(0)===e.aNeg)&&e.aSign&&e.pSign==="p"&&(r=this.io.aSign.length+(n.charAt(0)==="-"?1:0))):e.aSign&&e.pSign==="s"&&(r-=e.aSign.length)}this.that.value=n,this.setPosition(r),this.formatted=!0}},e.fn.autoNumeric=function(e){return this.each(function(){y.call(this,e)}).unbind(".autoNumeric").bind({"keydown.autoNumeric":b,"keypress.autoNumeric":w,"keyup.autoNumeric":E,"focusin.autoNumeric":S,"focusout.autoNumeric":x})},e.autoNumeric={},e.autoNumeric.Strip=function(t){var n=T(t),r=g(n);arguments[1]&&typeof arguments[1]=="object"&&(r=e.extend({},r,arguments[1]));var i=s(n,r),u=T(t).val();return u=o(u,i),u=a(u,i.aDec,i.aNeg),+u===0&&(u="0"),u},e.autoNumeric.Format=function(t,n){var r=T(t),i=g(r);arguments[2]&&typeof arguments[2]=="object"&&(i=e.extend({},i,arguments[2])),n.toString();var o=s(r,i);return n=p(n,o.mDec,o.mRound,o.aPad),n=f(n,o.aDec,o.aNeg),l(n,o)||(n=p("",o.mDec,o.mRound,o.aPad)),h(n,o)},e.fn.autoNumericGet=function(){return arguments[0]?e.autoNumeric.Strip(this,arguments[0]):e.autoNumeric.Strip(this)},e.fn.autoNumericSet=function(t){return arguments[1]?this.val(e.autoNumeric.Format(this,t,arguments[1])):this.val(e.fn.autoNumeric.Format(this,t))},e.autoNumeric.defaults={aNum:"0123456789",aSep:",",dGroup:"3",aDec:".",altDec:null,aSign:"",pSign:"p",vMax:"999999999.99",vMin:"0.00",mDec:null,mRound:"S",aPad:!0,wEmpty:"empty",aForm:!1},e.fn.autoNumeric.defaults=e.autoNumeric.defaults,e.fn.autoNumeric.Strip=e.autoNumeric.Strip,e.fn.autoNumeric.Format=e.autoNumeric.Format})(jQuery);